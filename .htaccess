<IfModule mod_rewrite.c>
    RewriteEngine On

    # =========================================================================
    # SECURITY: Block access to sensitive files
    # =========================================================================

    # Block .env, .env.backup, .env.staging, etc.
    RewriteRule ^\.env - [F,L,NC]

    # Block artisan
    RewriteRule ^artisan$ - [F,L]

    # Block composer files
    RewriteRule ^composer\.(json|lock)$ - [F,L]

    # Block package.json / package-lock.json
    RewriteRule ^package(-lock)?\.json$ - [F,L]

    # Block webpack/vite config
    RewriteRule ^(webpack\.mix|vite\.config|tailwind\.config)\.(js|ts)$ - [F,L]

    # Block PHP files in root (except index.php via public/)
    # RewriteRule ^[^/]+\.php$ - [F,L]

    # Block storage directory
    RewriteRule ^storage/ - [F,L]

    # Block vendor directory (except autoload required by public/index.php)
    RewriteRule ^vendor/ - [F,L]

    # Block database directory
    RewriteRule ^database/ - [F,L]

    # Block config directory
    RewriteRule ^config/ - [F,L]

    # Block app directory
    RewriteRule ^app/ - [F,L]

    # Block resources directory
    RewriteRule ^resources/ - [F,L]

    # Block bootstrap directory
    RewriteRule ^bootstrap/ - [F,L]

    # Block tests directory
    RewriteRule ^tests/ - [F,L]

    # Block docker directory
    RewriteRule ^docker/ - [F,L]

    # Block any .php file that's not in public/
    RewriteRule ^(?!public/)[^/]*\.php$ - [F,L]

    # Send everything to public/index.php if document root is project root
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ public/index.php [L]
</IfModule>

# Block directory listings
Options -Indexes

# Block access to hidden files (.git, .env, etc.)
<FilesMatch "^\.">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Block specific files
<FilesMatch "(artisan|composer\.(json|lock)|phpunit\.xml|Makefile|docker-compose\.yml|\.env.*)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>
